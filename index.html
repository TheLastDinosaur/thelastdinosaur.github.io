<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- //Get AFRAME -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    
    <!-- AR SDK -->
    <script src="./webar-sdk-v1.4.7.min.js" progress-dot-ring-color="#4444FF" progress-dot-ring-scale="0.30"></script>

    <!-- OTHER COMPONENTS -->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>
    <script src="/components/highlight.js"></script>
    <script src="/components/button.js"></script>

    <script>
        AFRAME.registerComponent('enable-click', {
            schema: {
                event: { type: 'string', default: '' },
                message: { type: 'string', default: 'Hello, World!' },
                towhere: { type: "vec3" },
                steps: {type: 'int', default: 0}
            },
            init: function () {
                var gamesManager = document.getElementById('game-manager');
                var self = this;
                this.eventHandlerFn = function () {
                    gameManager.emit("spawned");

                    var myPos = self.el.object3D.position;
                    var toPos = myPos + self.data.towhere;
                    console.log(self.data.towhere);
                    console.log(self.el.object3D.position);
                    self.el.setAttribute('animation', {'property': 'position', 'to': self.data.towhere});
                    console.log(self.el.object3D.position);
                    // gameManager.emit(self.el.id);
                    // console.log(self.el.id + "is the one");
                    UpdatePlayerPosition(self.el.id, 0, true);
                };
            },
            update: function (oldData) {
                var data = this.data;
                var el = this.el;

                // event updated
                if (data.event !== oldData.event) {
                    //remove the existing event
                    if (oldData.event) {
                        el.removeEventListener(oldData.event, this.eventHandlerFn);
                    }
                    // Add listener for new event, if it exists.
                    if (data.event) {
                        el.addEventListener(data.event, this.eventHandlerFn);
                    }
                }

                if (!data.event) {
                    console.log(data.message + "removed");
                }

            },

            remove: function () {
                if (this.data.event) {
                    this.el.removeEventListener(this.data.event, this.eventHandlerFn);
                }
            }
        });
    
        AFRAME.registerComponent('enable-moving', {
            schema: {
                event: { type: 'string', default: '' },
                steps: {type: 'int', default: 0}
            },
            init: function () {
                var self = this;
                this.eventHandlerFn = function () {
                    MakeAMove(self.el.id, self.data.steps );
                };
            },
            update: function (oldData){
                var data = this.data;
                var el = this.el;

                // event updated
                if (data.event !== oldData.event) {
                    //remove the existing event
                    if (oldData.event) {
                        el.removeEventListener(oldData.event, this.eventHandlerFn);
                    }
                    // Add listener for new event, if it exists.
                    if (data.event) {
                        el.addEventListener(data.event, this.eventHandlerFn);
                    }
                }

                if (!data.event) {
                    console.log(data.message + "removed");
                }
            },
            remove: function () {
                if (this.data.event) {
                    this.el.removeEventListener(this.data.event, this.eventHandlerFn);
                }
            }
        })
    </script>  
    <title>Ludo AR Game - DARE Digital</title>
</head>

<body>
    <a-scene webar-scene="key: 87bb4274-f25f-463a-804e-b21c282baffe"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    loading-screen="enabled: false"
    physics="debug:true;"
    id="scene"
    cursor="rayOrigin: mouse;" raycaster="objects: .rayclick, .raycastable, [button];">
        <a-assets>
            <!-- UI IMAGE -->
            <img id="titleui" src="./textures/ludo-title.png">
            <img id="yourturn" src="./textures/your_turn.png">

            <!-- dice ui images -->
            <img id="dice1" src="./textures/dice_info_1.png">
            <img id="dice2" src="./textures/dice_info_2.png">
            <img id="dice3" src="./textures/dice_info_3.png">
            <img id="dice4" src="./textures/dice_info_4.png">
            <img id="dice5" src="./textures/dice_info_5.png">
            <img id="dice6" src="./textures/dice_info_6.png">

            <!-- Animations -->
            <a-mixin id="highlight-me" animation="property: material.color; from: #FFF; to: #5A5A5A; dur: 750; delay: 500; easing: easeInOutSine; loop: true; dir: alternate"></a-mixin>

            <!-- //UI PLANES REVEAL ANIM -->
            <a-mixin id="plane" geometry="height: 1; width: 4"></a-mixin>
            <a-mixin id="flatui" material="shader: flat;"></a-mixin>
            <img id="startbtn_image" src="./textures/start-button.jpg" crossorigin="anonymous"/>
            <a-mixin
            id="frame"
            geometry="primitive: plane; width: 3; height:3"
            material="color: white; shader: flat"
            animation__scale="property: scale; to: 1.2 1.2 1.2; dur: 200; startEvents: mouseenter"
            animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
           ></a-mixin>
           <a-mixin
            id="poster"
            geometry="primitive: plane; width: 2.9; height: 2.9"
            material="color: white; shader: flat"
            material="shader: flat"
            position="0 0 0.005"
           ></a-mixin>
           <a-mixin
            id="movieImage"
            geometry="primitive: plane; width: 1.5; height: 0.81"
            material="src: #ponyo; shader: flat; transparent: true"
            position="0 0.495 0.002"
           ></a-mixin>

        </a-assets>

        <!-- AR STAGE -->
        <a-entity webar-stage>
        
            <!-- GAME CONTENT -->
        <a-entity position="0 -5 -7" scale="0.5 0.5 0.5" id="game-manager">
            

            <!-- //ALL UI ELEMENTS -->
            <a-entity scale="0.75 0.75 0.75" position="0 0 -5">

                <!-- Main Ui -->
                <a-entity visible="true" id="main_ui" position="0 5 0" animation="property: scale; from: 0 0 0; to: 1 1 1; dur: 750; delay: 500; easing: easeInOutSine;">

                    <a-plane width="10" height="10" rotation="0 0 0 " material="shader: flat; src: #titleui; transparent: false; alphaTest: 0.5"></a-plane>

                    <a-entity id="menu_start" rotation="90 0 0"
                        animation="property: rotation; from: -90 0 0; to: 0 0 0; dur: 750; delay: 500">
                        <a-entity button="label: START; func: ChooseMode" height="2" position="0 -2 0"></a-entity>
                    </a-entity>

                    <a-entity id="menu_mode" visible="false" rotation="90 0 0"
                        animation="property: rotation; from: -90 0 0; to: 0 0 0; dur: 750; delay: 500">
                        <a-entity button="label: OFFLINE; func: StartGame" height="2" position="-2 -2 0"></a-entity>
                        <a-entity button="label: ONLINE" height="2" position="2 -2 0"></a-entity>
                    </a-entity>                
                </a-entity>

                <!-- In Game UI -->
                <a-entity id="ingame_ui" visible="false" position="0 5 0">
                    
                    <!-- This is your turn -->
                    <a-entity id="your_turn" visible="false">
                        <a-plane 
                        width="10" height="2.2" rotation="0 0 0 " 
                        material="shader: flat; src: #yourturn; transparent: false; alphaTest: 0.5"
                        animation="property: scale; from: 0 0 0; to: 1 1 1; dur: 750; delay: 500; easing: easeInOutSine;"
                        position="0 5 0"
                        >
                        <a-text value="Your Turn" scale="3 3 1" align="center" position="0 0 0.1"> </a-text>
                    </a-plane>
                    <a-entity id="roll_menu" rotation="90 0 0"
                            animation="property: rotation; from: -90 0 0; to: 0 0 0; dur: 750; delay: 500">
                            <a-entity button="label: ROLL DICE; func: RollDice" height="2" position="0 2 0"></a-entity>
                    </a-entity>
                    </a-entity>

                    <!-- opponents tur -->
                    <a-entity id="opponents_turn" visible="false">
                        <a-plane 
                        width="10" height="2.2" rotation="0 0 0 " 
                        material="shader: flat; src: #yourturn; transparent: false; alphaTest: 0.5"
                        animation="property: scale; from: 0 0 0; to: 1 1 1; dur: 750; delay: 500; easing: easeInOutSine;"
                        position="0 5 0"
                        >
                        <a-text id="opponent_text" value="Your Turn" scale="3 3 1" align="center" position="0 0 0.1"> </a-text>
                    </a-plane>
                    <!-- <a-entity id="roll_menu" rotation="90 0 0"
                            animation="property: rotation; from: -90 0 0; to: 0 0 0; dur: 750; delay: 500">
                            <a-entity button="label: ROLL DICE; func: RollDice" height="2" position="0 2 0"></a-entity>
                    </a-entity> -->
                    </a-entity>

                    <!-- Dice Information -->
                    <a-entity id="dice_info" visible="false">
                        <a-plane id="dice_value"
                        width="5" height="5" rotation="0 0 0 " 
                        material="shader: flat; src: #dice1; transparent: false; alphaTest: 0.5"
                        animation="property: scale; from: 0 0 0; to: 1 1 1; dur: 750; delay: 500; easing: easeInOutSine;"
                        position="0 5 0"
                        ></a-plane>
                    </a-entity>
                </a-entity>

                <!-- victory ui -->
                <a-entity visible="false" id="victory_ui" position="0 5 0" animation="property: scale; from: 0 0 0; to: 1 1 1; dur: 750; delay: 500; easing: easeInOutSine;">

                    <a-plane width="10" height="10" rotation="0 0 0 " material="shader: flat; src: #titleui; transparent: false; alphaTest: 0.5"></a-plane>
                    <a-text id="victorytext" value="You Won" scale="3 3 1" align="center" position="0 -1 0.1"> </a-text>
                    <a-entity id="menu_restart" rotation="90 0 0"
                        animation="property: rotation; from: -90 0 0; to: 0 0 0; dur: 750; delay: 500">
                        <a-entity button="label: REPLAY; func: ChooseMode" height="2" position="0 -3 0"></a-entity>
                    </a-entity>

                                
                </a-entity>

            </a-entity>


            <a-entity id="board" visible="false">
            <a-plane src="./textures/ludo.jpg" rotation="-90 0 0" width="15" height="15" position="0 -0.11 0"> </a-plane>
            <!-- Red pawns -->
            <a-plane height="6" width="6" rotation="-90 0 0" id="player-1" position="-4.49311 -0.2 4.48936" color="red"></a-plane>
            <a-plane height="6" width="6" rotation="-90 0 0" id="player-2" position="-4.501 -0.2 -4.47523" color="green"></a-plane>
            <a-plane height="6" width="6" rotation="-90 0 0" id="player-3" position="4.48 -0.2 -4.47523" color="yellow"></a-plane>
            <a-plane height="6" width="6" rotation="-90 0 0" id="player-4" position="4.48 -0.2 4.48222" color="blue"></a-plane>
            
            <!-- Green Pawn1 -->
            <a-box id="greenPawn1" position="-5.5 0.25 -3.5"  color="#00632d" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>
            <a-box id="greenPawn2" position="-3.5 0.25 -3.5"  color="#00632d" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>
            <a-box id="greenPawn3" position="-3.5 0.25 -5"  color="#00632d" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>
            <a-box id="greenPawn4" position="-5.5 0.25 -5"  color="#00632d" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>

            <!-- Yellow Pawns -->

            <a-box id="yellowPawn1" position="3.5 0.25 -3.5"  color="#ccb100" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>
            <a-box id="yellowPawn2" position="5.5 0.25 -3.5"  color="#ccb100" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>
            <a-box id="yellowPawn3" position="5.5 0.25 -5.5"  color="#ccb100" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>
            <a-box id="yellowPawn4" position="3.5 0.25 -5.5"  color="#ccb100" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>

            
            <!-- Blue Pawns -->

            <a-box id="bluePawn1" position="5.5 0.25 3.5"  color="#0c6399" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>
            <a-box id="bluePawn2" position="3.5 0.25 3.5"  color="#0c6399" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>
            <a-box id="bluePawn3" position="3.5 0.25 5.5"  color="#0c6399" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>
            <a-box id="bluePawn4" position="5.5 0.25 5.5"  color="#0c6399" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>


            <a-box id="redPawn1" 
                position="-3.5 0.25 5.5" class="rayclick"
                color="#980007" 
                width="0.5" height="0.5" depth="0.5">

            </a-box>
               <!-- <a-box id="redPawn1" 
                position="0 0 7" class="rayclick"
                color="red" 
                width="0.5" height="0.5" depth="0.5">

            </a-box> -->
            <a-box id="redPawn2" position="-3.5 0.25 3.5" class="rayclick"
                color="#980007" width="0.5" height="0.5" depth="0.5" material="" geometry="">

            </a-box>

            <a-box id="redPawn3" position="-5.5 0.25 5.5" class="rayclick"  
            color="#980007" width="0.5" height="0.5"
                depth="0.5">

            </a-box>


            <a-box id="redPawn4" position="-5.5 0.25 3.5" class="rayclick" 
            color="#980007" width="0.5" height="0.5"
                depth="0.5" material="" geometry="">

            </a-box>


            



            <!-- position reference plane/ -->
            <!-- <a-entity geometry="primitive: plane" rotation="-90 0 0" position="-1 0 6" id="reference"></a-entity> -->
            
            </a-entity>
            <!-- <a-plane color="red" rotation="-90 0 0" width="15" height="15" position="0 -0.11 0"> </a-plane> -->

        </a-entity>

    <!-- AR STAGE END -->
    </a-entity>
        <!-- VR CAMERA -->
        <!-- <a-entity camera="" position="0 5 0" wasd-controls=""  look-controls="" aframe-injected="" data-aframe-inspector-original-camera="" id="camera"></a-entity> -->

         <!-- Blippar Camera -->
         <a-camera webar-camera > 
         </a-camera>

    </a-scene>

<script src="dare.js"></script>

</body>

</html>