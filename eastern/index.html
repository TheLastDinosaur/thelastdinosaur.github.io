
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.1/dist/mindar-image-aframe.prod.js"></script>
    <script>
                AFRAME.registerComponent('cloak', {
                  init: function() {
                let mesh = this.el.getObject3D('mesh')
                if (mesh !== undefined) {
                  mesh.traverse(function(node) {
                    if (node.isMesh) {
                      if (node.material) {
                        node.material.colorWrite = false
                        node.material.needsUpdate = true;
                      }
                    }
                  });
                }
              }
            })


            AFRAME.registerComponent('vidhandler', {
                    init: function () {
                      this.toggle = false;
                      document.querySelector("#mainvideo").pause(); //reference to the video
                    },
                    tick:function(){  
                    if(document.querySelector("#target").object3D.visible == true){
                      if(!this.toggle){
                        this.toggle = true;
                        document.querySelector("#mainvideo").play();
                      }
                    }else{
                      this.toggle = false;
                      document.querySelector("#mainvideo").pause();
                    }
                    }
              });

           
  </script>


    
  </head>
  <body>
    <a-scene  
    color-space="sRGB" 
    renderer="colorManagement: true, physicallyCorrectLights" 
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false"
    loading-screen="dotsColor: red; backgroundColor: black"
    mindar-image="imageTargetSrc: ./targets.mind;  filterMinCF:0.001;  filterBeta: 0.001; maxTrack: 1; "
    >
    
      <a-assets>
        <a-asset-item id="firstModel" src="./my_building.gltf"></a-asset-item>
        <a-asset-item id="secondModel" src="./studio_apartment_vray_baked_textures_included.glb"></a-asset-item>
        <a-asset-item id="towerModel" src="./tower map.gltf"></a-asset-item>

        <!-- //images -->
        <img id="360icon" src="./360_view.png">
        <img id="view-in3d" src="./viewin3d.png">

        <!-- //VR Images -->
        <img id="living" src="./living.jpeg">
        <img id="walkway" src="./pathway.jpeg">

        <video id="mainvideo" playsinline loop webkit-playsinline src="./video.mp4"></video>

      </a-assets>
      <a-camera id="maincam" position="0 0 0" 
      look-controls="enabled: false"
      cursor="fuse: false; rayOrigin: mouse;" raycaster="near: 10; far: 10000; objects: .collidable"
      ></a-camera>


      <!-- // AR Contents // -->
        <a-entity class="mind-image"  mindar-image-target="targetIndex: 0">
          <a-entity scale="0.1 0.1 0.1" position="0 0 -0.1 ">
            <a-gltf-model rotation="90 0 0 " position="0 0 0" scale="0.2 0.2 0.2" src="#firstModel" animation-mixer>
          </a-entity>
          <!-- <a-plane color="orange" scale="0.2 0.2 0.2" position="0 -0.6 0.01"></a-plane> -->
        </a-entity>


        <a-entity class="mind-image"  id="target" mindar-image-target="targetIndex: 1">
          <a-video vidhandler src="#mainvideo" rotation="0 0 0" scale="0.65 0.65 0.65" position="0 0 0" width="1.6" height="0.9"></a-video>
        </a-entity>

        <a-entity class="mind-image"  id="target" mindar-image-target="targetIndex: 2">
          <a-plane class="django" material="shader: flat; color: gold; opacity: 0.2" height="0.55"></a-plane>
          <a-plane class="collidable django" id="360-bhk" position="0 0 0.02" scale="0.2 0.2 0.2" material="shader:flat; src:#360icon; transparent: true"></a-plane>
        </a-entity>

        <a-entity class="mind-image"  id="target" mindar-image-target="targetIndex: 3">
          <a-plane class="django" material="shader: flat; color: gold; opacity: 0.2" height="0.55"></a-plane>
          <a-plane class="collidable django" id="360-walkway" position="0 0 0.02" scale="0.2 0.2 0.2" material="shader:flat; src:#360icon; transparent: true"></a-plane>
        </a-entity>


        <a-entity class="mind-image"  mindar-image-target="targetIndex: 4">
          <a-entity scale="0.1 0.1 0.1">
              <a-gltf-model rotation="180 90 90 " position="0 -0.25 0" scale="1 1 1" src="#secondModel" animation-mixer>
          </a-entity>

        </a-entity>

        <a-entity class="mind-image"  mindar-image-target="targetIndex: 6">
                
            <a-entity id="towerIcons">
              <a-plane class="collidable" 
                  id="t1" position="-0.23 0.015 0.01" 
                  scale="0.2 0.2 0.2" 
                  material="shader:flat; src:#view-in3d; transparent: true">
                </a-plane>

                <a-plane class="collidable" 
                  id="t2" position="-0.04 0.09 0.01" 
                  scale="0.2 0.2 0.2" 
                  material="shader:flat; src:#view-in3d; transparent: true">
                </a-plane>

                <a-plane class="collidable" 
                  id="t3" position="-0.32 -0.19 0.01" 
                  scale="0.2 0.2 0.2" 
                  material="shader:flat; src:#view-in3d; transparent: true">
                </a-plane>

                <a-plane class="collidable" 
                  id="t4" position="-0.1 -0.16 0.01" 
                  scale="0.2 0.2 0.2" 
                  material="shader:flat; src:#view-in3d; transparent: true">
                </a-plane>

                <a-plane class="collidable" 
                  id="t5" position="0.094 -0.09 0.01" 
                  scale="0.2 0.2 0.2" 
                  material="shader:flat; src:#view-in3d; transparent: true">
                </a-plane>
            </a-entity>

            <a-entity id="modelholder">
             
            </a-entity>


        </a-entity>


        <!-- // VR CONTENTS // -->
        <a-entity id="skydom" visible="false">
        <a-entity id="vrcam" camera look-controls position="0 1.6 0" cursor="fuse: true; rayOrigin: mouse;" raycaster="near: 0.1; far: 10000; objects: .collidable">
          <a-plane id="360-close" position=".65 1.4 -2" scale="0.2 0.2 0.2" src="#360icon" class="collidable"></a-plane>
        </a-entity>
          <a-sky id="skymap" color="#ECECEC" src="#living" phi-start="310" visible="true"></a-sky>
        </a-entity>
        

    </a-scene>

    
    <script>
//        window.addEventListener('click', function () { 
//    document.querySelector('#mainvideo').play();
//  });

    const arItems = document.querySelectorAll(".mind-image");

    // VR View buttons

    document.getElementById("360-bhk").addEventListener("click", function(e){
      document.getElementById("skymap").setAttribute("src", "#living")
      LaunchVRView();
    });

    document.getElementById("360-walkway").addEventListener("click", (e)=>{
      document.getElementById("skymap").setAttribute("src", "#walkway");
      LaunchVRView();
    });

    document.getElementById("t1").addEventListener("click", (e)=>{

      document.getElementById('towerIcons').setAttribute("visible", false);
      document.getElementById('modelholder').innerHTML = ' <a-gltf-model class="collidable"  id="tower-model" rotation="90 0 0 " position="0 0 0" scale="0.4 0.4 0.4" src="#towerModel" animation="property: scale; from: 0 0 0; to: 0.4 0.4 0.4; dur: 2000; easing: easeInOutSine;">'
      document.getElementById("tower-model").addEventListener("click", (e)=>{
        // alert("Clicked on Towe");
        document.getElementById('modelholder').innerHTML = '<a-entity scale="0.1 0.1 0.1"> <a-gltf-model rotation="180 90 90 " id="1bhkjump" class="collidable" position="0 -0.25 0" scale="1 1 1" src="#secondModel" animation-mixer animation="property: scale; from: 0 0 0; to: 1 1 1; dur: 2000; easing: easeInOutSine;"> </a-entity>'
          document.getElementById('1bhkjump').addEventListener("click", (e)=>{
            document.getElementById('modelholder').innerHTML = "";
            document.getElementById('towerIcons').setAttribute("visible", true);

          })

    })

      // alert("clicked on t1");
    });
    document.getElementById("t2").addEventListener("click", (e)=>{
      alert("Only tower 1 is active in this demo");
    });

    document.getElementById("t3").addEventListener("click", (e)=>{
      alert("Only tower 1 is active in this demo");
    });

    document.getElementById("t4").addEventListener("click", (e)=>{
      alert("Only tower 1 is active in this demo");
    });

    document.getElementById("t5").addEventListener("click", (e)=>{
      alert("Only tower 1 is active in this demo");
    });



    // close the VR view
    document.getElementById('360-close').addEventListener("click",  function(e){

      CloseVRView();

    });

    const LaunchVRView = function(){
          const sceneEl = document.querySelector('a-scene');
          const arSystem = sceneEl.systems["mindar-image-system"];
          arSystem.stop();


          setTimeout((e)=>{
            arItems.forEach((itme)=>{
              itme.setAttribute("visible", false)
          });

          }, 1000);

          // console.log(arSystem);
          console.log(arItems);
          document.getElementById('maincam').setAttribute("camera", "active", false);
          document.getElementById('skydom').setAttribute('visible', true);

    }

    const CloseVRView = function(){
        window.location.reload();


        // //   setTimeout((e)=>{
        // //   arItems.forEach((itme)=>{
        // //         itme.setAttribute("visible", false);
        // //     });
        // //     alert("DONE");
        // //   }, 1500);
        //   document.getElementsByClassName("django").forEach((item)=>{
        //     item.setAttribute("visible", false);
        //   })
    }

    </script>
  </body>
</html>